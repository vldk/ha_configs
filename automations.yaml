- id: '1609622210171'
  alias: Пожати базу
  description: MariaDB
  trigger:
  - platform: time
    at: 01:00:00
  condition: []
  action:
  - service: recorder.purge
    data:
      keep_days: 4
      repack: true
  mode: single
- id: trv_calibration_11_1
  alias: Калібрування головки 11_right
  description: Калібрування локальної температури термоголовки 11_1 по сенсору в кімнаті
  trigger:
  - platform: time_pattern
    minutes: /5
  - platform: template
    value_template: '{{ (state_attr(''climate.0x5c0272fffedabc57'', ''current_temperature'')|float
      - states(''sensor.0x5c0272fffec72d04_temperature'')|float)|abs > 0.25 }}'
    for: 00:00:02
  action:
  - service: mqtt.publish
    data_template:
      topic: zigbee2mqtt/{{state_attr('climate.0x5c0272fffedabc57','friendly_name')}}/set/local_temperature_calibration
      payload_template: "{{(state_attr('climate.0x5c0272fffedabc57','local_temperature_calibration')|float\
        \ -\n    state_attr('climate.0x5c0272fffedabc57', 'current_temperature')|float\
        \ +\n    states('sensor.0x5c0272fffec72d04_temperature')|float + 128)|round(1,'half')}}"
  mode: single
- id: trv_calibration_11_2
  alias: Калібрування головки 11_left
  description: Калібрування локальної температури термоголовки 11_2 по сенсору в кімнаті
  trigger:
  - platform: time_pattern
    minutes: /5
  - platform: template
    value_template: '{{ (state_attr(''climate.0x5c0272fffedabed2'', ''current_temperature'')|float
      - states(''sensor.0x5c0272fffec72d04_temperature'')|float)|abs > 0.25 }}'
    for: 00:00:02
  action:
  - service: mqtt.publish
    data_template:
      topic: zigbee2mqtt/{{state_attr('climate.0x5c0272fffedabed2','friendly_name')}}/set/local_temperature_calibration
      payload_template: "{{(state_attr('climate.0x5c0272fffedabed2','local_temperature_calibration')|float\
        \ -\n    state_attr('climate.0x5c0272fffedabed2', 'current_temperature')|float\
        \ +\n    states('sensor.0x5c0272fffec72d04_temperature')|float + 128)|round(1,'half')}}"
  mode: single
- id: trv_calibration_21_1
  alias: Калібрування головки 21_right
  description: Калібрування локальної температури термоголовки 21_1 по сенсору в кімнаті
  trigger:
  - platform: time_pattern
    minutes: /5
  - platform: template
    value_template: '{{ (state_attr(''climate.0x847127fffe960b38'', ''current_temperature'')|float
      - states(''sensor.0x847127fffe18e757_temperature'')|float)|abs > 0.25 }}'
    for: 00:00:02
  action:
  - service: mqtt.publish
    data_template:
      topic: zigbee2mqtt/{{state_attr('climate.0x847127fffe960b38','friendly_name')}}/set/local_temperature_calibration
      payload_template: "{{(state_attr('climate.0x847127fffe960b38','local_temperature_calibration')|float\
        \ -\n    state_attr('climate.0x847127fffe960b38', 'current_temperature')|float\
        \ +\n    states('sensor.0x847127fffe18e757_temperature')|float + 128)|round(1,'half')}}"
  mode: single
- id: trv_calibration_21_2
  alias: Калібрування головки 21_left
  description: Калібрування локальної температури термоголовки 21_2 по сенсору в кімнаті
  trigger:
  - platform: time_pattern
    minutes: /5
  - platform: template
    value_template: '{{ (state_attr(''climate.0x847127fffe940161'', ''current_temperature'')|float
      - states(''sensor.0x847127fffe18e757_temperature'')|float)|abs > 0.25 }}'
    for: 00:00:02
  action:
  - service: mqtt.publish
    data_template:
      topic: zigbee2mqtt/{{state_attr('climate.0x847127fffe940161','friendly_name')}}/set/local_temperature_calibration
      payload_template: "{{(state_attr('climate.0x847127fffe940161','local_temperature_calibration')|float\
        \ -\n    state_attr('climate.0x847127fffe940161', 'current_temperature')|float\
        \ +\n    states('sensor.0x847127fffe18e757_temperature')|float + 128)|round(1,'half')}}"
  mode: single
- id: trv_calibration_22_1
  alias: Калібрування головки 22_right
  description: Калібрування локальної температури термоголовки 22_1 по сенсору в кімнаті
  trigger:
  - platform: time_pattern
    minutes: /5
  - platform: template
    value_template: '{{ (state_attr(''climate.0x5c0272fffed9d5ff'', ''current_temperature'')|float
      - states(''sensor.0x5c0272fffebda093_temperature'')|float)|abs > 0.25 }}'
    for: 00:00:02
  action:
  - service: mqtt.publish
    data_template:
      topic: zigbee2mqtt/{{state_attr('climate.0x5c0272fffed9d5ff','friendly_name')}}/set/local_temperature_calibration
      payload_template: "{{(state_attr('climate.0x5c0272fffed9d5ff','local_temperature_calibration')|float\
        \ -\n    state_attr('climate.0x5c0272fffed9d5ff', 'current_temperature')|float\
        \ +\n    states('sensor.0x5c0272fffebda093_temperature')|float + 128)|round(1,'half')}}"
  mode: single
- id: trv_calibration_22_2
  alias: Калібрування головки 22_middle
  description: Калібрування локальної температури термоголовки 22_2 по сенсору в кімнаті
  trigger:
  - platform: time_pattern
    minutes: /5
  - platform: template
    value_template: '{{ (state_attr(''climate.0x5c0272fffedab255'', ''current_temperature'')|float
      - states(''sensor.0x5c0272fffebda093_temperature'')|float)|abs > 0.25 }}'
    for: 00:00:02
  action:
  - service: mqtt.publish
    data_template:
      topic: zigbee2mqtt/{{state_attr('climate.0x5c0272fffedab255','friendly_name')}}/set/local_temperature_calibration
      payload_template: "{{(state_attr('climate.0x5c0272fffedab255','local_temperature_calibration')|float\
        \ -\n    state_attr('climate.0x5c0272fffedab255', 'current_temperature')|float\
        \ +\n    states('sensor.0x5c0272fffebda093_temperature')|float + 128)|round(1,'half')}}"
  mode: single
- id: trv_calibration_22_3
  alias: Калібрування головки 22_left
  description: Калібрування локальної температури термоголовки 22_3 по сенсору в кімнаті
  trigger:
  - platform: time_pattern
    minutes: /5
  - platform: template
    value_template: '{{ (state_attr(''climate.0x847127fffe93ff05'', ''current_temperature'')|float
      - states(''sensor.0x5c0272fffebda093_temperature'')|float)|abs > 0.25 }}'
    for: 00:00:02
  action:
  - service: mqtt.publish
    data_template:
      topic: zigbee2mqtt/{{state_attr('climate.0x847127fffe93ff05','friendly_name')}}/set/local_temperature_calibration
      payload_template: "{{(state_attr('climate.0x847127fffe93ff05','local_temperature_calibration')|float\
        \ -\n    state_attr('climate.0x847127fffe93ff05', 'current_temperature')|float\
        \ +\n    states('sensor.0x5c0272fffebda093_temperature')|float + 128)|round(1,'half')}}"
  mode: single
- id: toggle_switch2
  alias: 'Котли: Котли: вкл. ел. котел -> викл.газ. котел'
  description: Виключити газ. котел при включенні ел. котла
  trigger:
  - platform: state
    entity_id: switch.0x00124b00209e96c4_l2
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: switch.0x00124b00209e96c4_l1
    state: 'on'
  action:
  - service: switch.turn_off
    entity_id: switch.0x00124b00209e96c4_l1
  mode: single
- id: toggle_switch1
  alias: 'Котли: вкл. газ. котел -> викл. ел. котел'
  description: 'Котли: виключити ел. котел при вкюченні газ. котла'
  trigger:
  - platform: state
    entity_id: switch.0x00124b00209e96c4_l1
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: switch.0x00124b00209e96c4_l2
    state: 'on'
  action:
  - service: switch.turn_off
    entity_id: switch.0x00124b00209e96c4_l2
  mode: single
- id: run_gas_boiler_delay_timer
  alias: 'Котли: таймаут газ. котла'
  description: Запустити затримку запуску газ. котла при виключенні
  trigger:
  - platform: device
    type: turned_off
    device_id: 972efa4469c7dbc89ad0cb3a5459d3db
    entity_id: switch.0x00124b00209e96c4_l1
    domain: switch
  condition: []
  action:
  - service: timer.start
    data: {}
    entity_id: timer.boiler_gas_turn_on_timer
  mode: single
- id: run_electri_boiler_delay_timer
  alias: 'Котли: таймаут ел. котла'
  description: Запустити затримку запуску ел. котла при виключенні
  trigger:
  - platform: device
    type: turned_off
    device_id: 972efa4469c7dbc89ad0cb3a5459d3db
    entity_id: switch.0x00124b00209e96c4_l2
    domain: switch
  condition: []
  action:
  - service: timer.start
    data: {}
    entity_id: timer.boiler_electro_turn_on_timer
  mode: single
- id: '1611223999739'
  alias: 'Виявлено дим '
  description: 'Відправити в телеграм алярму про дим '
  trigger:
  - platform: state
    entity_id: binary_sensor.0x00158d0005294284_smoke
    from: 'off'
    to: 'on'
  - platform: state
    entity_id: binary_sensor.0x00158d000544c35d_smoke
    from: 'off'
    to: 'on'
  - platform: state
    entity_id: binary_sensor.0x00158d00052d1217_smoke
    from: 'off'
    to: 'on'
  action:
  - service: script.turn_on
    entity_id: script.send_on_smoke_detect_s1
  mode: single
- id: '1611264838756'
  alias: PTerm1 -> TRV_Gropup_1
  description: Синхронізація цільової темп. з програмного термостату в групу термоголовок
  trigger:
  - platform: state
    entity_id: climate.pterm_room_11
  condition:
  - condition: template
    value_template: "{{ trigger.from_state and\n    trigger.to_state.attributes.temperature\
      \ !=\n    trigger.from_state.attributes.temperature }}\n"
  action:
  - service: climate.set_temperature
    entity_id: climate.trv_group_11
    data_template:
      temperature: '{{ state_attr(''climate.pterm_room_11'', ''temperature'') }}'
  mode: single
- id: '1611268219598'
  alias: PTerm21 -> TRV_Gropup_21
  description: Синхронізація цільової темп. з програмного термостату в групу термоголовок
  trigger:
  - platform: state
    entity_id: climate.pterm_room_21
  condition:
  - condition: template
    value_template: "{{ trigger.from_state and\n    trigger.to_state.attributes.temperature\
      \ !=\n    trigger.from_state.attributes.temperature }}\n"
  action:
  - service: climate.set_temperature
    entity_id: climate.trv_group_21
    data_template:
      temperature: '{{ state_attr(''climate.pterm_room_21'', ''temperature'') }}'
  mode: single
- id: '1611268259056'
  alias: PTerm22 -> TRV_Gropup_22
  description: Синхронізація цільової темп. з програмного термостату в групу термоголовок
  trigger:
  - platform: state
    entity_id: climate.pterm_room_22
  condition:
  - condition: template
    value_template: "{{ trigger.from_state and\n    trigger.to_state.attributes.temperature\
      \ !=\n    trigger.from_state.attributes.temperature }}\n"
  action:
  - service: climate.set_temperature
    entity_id: climate.trv_group_22
    data_template:
      temperature: '{{ state_attr(''climate.pterm_room_22'', ''temperature'') }}'
  mode: single
- id: '1611344598133'
  alias: Віхідні двері - Open
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.0x00158d00019f34e2_contact
    from: 'off'
    to: 'on'
  condition: []
  action:
  - service: script.send_on_main_door_open
    data: {}
  mode: single
- id: '1611344637707'
  alias: Віхідні двері - Close
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.0x00158d00019f34e2_contact
    from: 'on'
    to: 'off'
  condition: []
  action:
  - service: notify.telegram_id1
    data:
      message: Закриті вхідні двері
  mode: single
- id: '1611577214592'
  alias: Алярма при відкритті воріт
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.0x00158d0001e4a6db_contact
    from: 'off'
    to: 'on'
  condition: []
  action:
  - service: script.send_on_garage_door_open
    data: {}
  mode: single
- id: '1611577241562'
  alias: Алярма при закритті воріт
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.0x00158d0001e4a6db_contact
    from: 'on'
    to: 'off'
  condition: []
  action:
  - service: script.send_on_garage_door_closed
    data: {}
  mode: single
- id: '1611589628180'
  alias: Алярма - дощ і мансарда
  description: Алярма - при дощі закрити на мансарді вікна
  trigger:
  - platform: state
    entity_id: weather.golovna
    to: rainy
  condition:
  - condition: or
    conditions:
    - condition: state
      entity_id: binary_sensor.0x00158d00019f49d5_contact
      state: 'on'
    - condition: state
      entity_id: binary_sensor.0x00158d00019d08a8_contact
      state: 'on'
  action:
  - service: script.send_on_rainy_window_open
    data: {}
  mode: single
- id: '1611610986123'
  alias: 'Котли: зміна нічного тарифу на ніч'
  description: Вимкнути ел. котел не в нічний тариф (або запустити газовий, якщо потрібно  гріти
    далі)
  trigger:
  - platform: state
    entity_id: binary_sensor.tod_night_tariff
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: binary_sensor.boiler_is_on
    state: 'on'
  action:
  - service: script.boiler_turn_on
    data: {}
  mode: single
- id: '1612040388191'
  alias: 'Котли: зміна нічного тарифу на день'
  description: Вимкнути ел. котел не в нічний тариф (або запустити газовий, якщо потрібно  гріти
    далі)
  trigger:
  - platform: state
    entity_id: binary_sensor.tod_night_tariff
    from: 'on'
    to: 'off'
  condition:
  - condition: state
    entity_id: binary_sensor.boiler_is_on
    state: 'on'
  action:
  - service: script.turn_on
    data: {}
    entity_id: script.boiler_turn_on
  mode: single
- id: '1612131835798'
  alias: Котрли - відкриті вікна
  description: Алярма при включені котла при відритому будь-яком вікні в кімнатах
  trigger:
  - platform: state
    entity_id: binary_sensor.boiler_is_on
    from: 'off'
    to: 'on'
  condition:
  - condition: or
    conditions:
    - condition: state
      entity_id: binary_sensor.0x00158d0001ddc9c2_contact
      state: 'on'
    - condition: state
      entity_id: binary_sensor.0x00158d0001de18e8_contact
      state: 'on'
    - condition: state
      entity_id: binary_sensor.0x00158d0001e4c675_contact
      state: 'on'
    - condition: state
      entity_id: binary_sensor.0x00158d0001e4d72a_contact
      state: 'on'
  action:
  - service: script.send_on_boiler_on_and_any_window_open
    data: {}
  mode: single
- id: '1613129977445'
  alias: Сходи - старт таймеру на виключення - розетка
  description: ''
  trigger:
  - platform: state
    entity_id: switch.switch
    to: 'on'
  condition: []
  action:
  - service: timer.cancel
    data: {}
    entity_id: timer.taimer_vikliuchennia_pidsvidki
  - service: timer.start
    data: {}
    entity_id: timer.taimer_vikliuchennia_pidsvidki
  mode: single
- id: '1613130598701'
  alias: Сходи - старт таймеру на виключення - рух
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.0x00158d00066982e9_occupancy
    to: 'on'
  condition: []
  action:
  - service: timer.cancel
    data: {}
    entity_id: timer.taimer_vikliuchennia_pidsvidki
  - service: timer.start
    data: {}
    entity_id: timer.taimer_vikliuchennia_pidsvidki
  mode: single
- id: '1613130817123'
  alias: Сходи - виключення по таймеру
  description: ''
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.taimer_vikliuchennia_pidsvidki
  condition:
  - condition: state
    entity_id: switch.switch
    state: 'on'
  action:
  - service: switch.turn_off
    data: {}
    entity_id: switch.switch
  mode: single
- id: '1613131383833'
  alias: Сходи - вкючення по рухові
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.0x00158d00066982e9_occupancy
    from: 'off'
    to: 'on'
  condition:
  - condition: and
    conditions:
    - condition: device
      type: is_off
      device_id: ea84bceca6d35d922c3b15862baab96d
      entity_id: switch.switch
      domain: switch
    - type: is_illuminance
      condition: device
      device_id: 818c57996a46cb2cd8ff8fe6374bbd2c
      entity_id: sensor.0x00158d00066982e9_illuminance
      domain: sensor
      below: 10
  action:
  - type: turn_on
    device_id: ea84bceca6d35d922c3b15862baab96d
    entity_id: switch.switch
    domain: switch
  mode: single
- id: '1613148741306'
  alias: Сходи - Тест ON
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.0x00158d00066982e9_occupancy
    to: 'on'
  condition: []
  action:
  - type: turn_on
    device_id: ea84bceca6d35d922c3b15862baab96d
    entity_id: switch.switch
    domain: switch
  mode: single
- id: '1613148846009'
  alias: Сходи - Тест OFF
  description: ''
  trigger:
  - type: no_motion
    platform: device
    device_id: 818c57996a46cb2cd8ff8fe6374bbd2c
    entity_id: binary_sensor.0x00158d00066982e9_occupancy
    domain: binary_sensor
  condition: []
  action:
  - type: turn_off
    device_id: ea84bceca6d35d922c3b15862baab96d
    entity_id: switch.switch
    domain: switch
  mode: single
- id: '1613335438165'
  alias: Світло - коридор вкл.
  description: ''
  trigger:
  - type: motion
    platform: device
    device_id: ecd183eb327710a70c26935ea8e4c382
    entity_id: binary_sensor.0x00158d000669535b_occupancy
    domain: binary_sensor
  condition:
  - type: is_illuminance
    condition: device
    device_id: ecd183eb327710a70c26935ea8e4c382
    entity_id: sensor.0x00158d000669535b_illuminance_lux
    domain: sensor
    below: 6
  action:
  - type: turn_on
    device_id: 832ed3f6caca722ea4d040433a1f3a45
    entity_id: switch.0x847127fffe24e50e
    domain: switch
  mode: single
- id: '1613335511845'
  alias: Світло - коридор викл.
  description: ''
  trigger:
  - type: no_motion
    platform: device
    device_id: ecd183eb327710a70c26935ea8e4c382
    entity_id: binary_sensor.0x00158d000669535b_occupancy
    domain: binary_sensor
  condition:
  - condition: device
    type: is_on
    device_id: 832ed3f6caca722ea4d040433a1f3a45
    entity_id: switch.0x847127fffe24e50e
    domain: switch
  action:
  - type: turn_off
    device_id: 832ed3f6caca722ea4d040433a1f3a45
    entity_id: switch.0x847127fffe24e50e
    domain: switch
  mode: single
- id: '1614114231282'
  alias: ToggleGirland
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: a820abbc9e5aa94d2bb95224770f117c
    type: action
    subtype: 1_single
    discovery_id: 0x60a423fffe650fbb action_1_single
  condition: []
  action:
  - type: toggle
    device_id: 7faf8a7e1ef6c9f5dd2acea20dc71680
    entity_id: switch.wifi_socket_2_switch
    domain: switch
  mode: single
- id: '1614265326796'
  alias: Нова автоматизація
  description: ''
  trigger:
  - type: power
    platform: device
    device_id: ca595ae56a01026c67e1a4d6c9bb0785
    entity_id: sensor.0x842e14fffe3a4631_power
    domain: sensor
    below: 1
    for:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  condition: []
  action:
  - service: script.turn_on
    data: {}
    entity_id: script.send_on_wash_end
  mode: single
